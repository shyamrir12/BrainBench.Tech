

<MudTextField @bind-Value="searchText" Variant="Variant.Filled" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Search" OnAdornmentClick="HandleSearch" AdornmentAriaLabel="Search">

</MudTextField>

<Virtualize ItemsProvider="loadOnlyVisibleItems" Context="singleuser" @ref="virtualizeComponent">
    <ItemContent>
        <MudCard style="margin-bottom: 5px;">

            <MudCardHeader>
                <CardHeaderAvatar>
                    <MudAvatar Color="Color.Secondary">I</MudAvatar>
                </CardHeaderAvatar>
                <CardHeaderContent>
                    <MudText Typo="Typo.body1">@singleuser.name</MudText>
                    <MudText Typo="Typo.body2">@singleuser.email</MudText>
                </CardHeaderContent>
                <CardHeaderActions>
                    <MudMenu Icon="@Icons.Material.Filled.MoreVert" AnchorOrigin="Origin.TopRight" TransformOrigin="Origin.TopLeft">
                        <MudStack>
                            <MudIconButton Icon="@Icons.Material.Filled.Edit" OnClick="@(e => edituserevent(singleuser))"></MudIconButton>
                            <MudIconButton Icon="@Icons.Material.Filled.Delete" OnClick="@(e => deleteuserevent(singleuser))"></MudIconButton>
                        </MudStack>
                    </MudMenu>
                </CardHeaderActions>
            </MudCardHeader>

        </MudCard>
    </ItemContent>
    <Placeholder>
        <MudCard style="margin-bottom: 5px;">

            <MudCardHeader>
                Loading...
            </MudCardHeader>
        </MudCard>
    </Placeholder>


</Virtualize>

@code {

    //1 for pass item to parent add event for selected edit item
    [Parameter]
    public EventCallback<AddUserModel> OnUserSelection { get; set; }

    //6.declare parameter for the parent
    [Parameter]
    public AddUserModel adduserparam { get; set; }

    private Virtualize<AddUserModel>? virtualizeComponent;

    private string searchText;


    private List<AddUserModel> adduserlist = new List<AddUserModel>
    {
        new  AddUserModel{name="Shyam",email="Shyam@gmail.com"},
        new  AddUserModel{name="umang",email="umang@gmail.com"},
        new  AddUserModel{name="Shyamn",email="Shyam@gmailn.com"},
        new  AddUserModel{name="umangl",email="umang@gmaill.com"}

    };
    protected override async Task OnInitializedAsync()
    {
        for (int i = 1; i <= 20000; i++)
        {
            AddUserModel dummyuser = new AddUserModel { name = "Test uaer" + i, email = "Shyam@gmail.com" + i };
            adduserlist.Add(dummyuser);
        }
    }

    private void HandleSearch()
    {
        virtualizeComponent?.RefreshDataAsync();
        StateHasChanged();
    }

    private async ValueTask<ItemsProviderResult<AddUserModel>> loadOnlyVisibleItems(ItemsProviderRequest itemsProviderRequest)
    {
        //itemsProviderRequest.StartIndex;
        //itemsProviderRequest.Count;
        List<AddUserModel> RengList = new List<AddUserModel>();

        if (String.IsNullOrEmpty(searchText))
        {
            RengList = adduserlist.GetRange(itemsProviderRequest.StartIndex, itemsProviderRequest.Count);
        }
        else
        {
            RengList = adduserlist.Where(item => item.name.Contains(searchText, StringComparison.OrdinalIgnoreCase)).ToList();

        }

        //await Task.Delay(1000);
        return new ItemsProviderResult<AddUserModel>(RengList, 20000);
    }

    //6. setting parent (added or edited item) parameter to list item
    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        //call API to reload the data from data base

        if (adduserparam.designation == "Save")
        {
            adduserlist.Add(adduserparam);
        }


        //StateHasChanged();
    }




    private void deleteuserevent(AddUserModel? aum)
    {
        adduserlist.Remove(aum);
        // StateHasChanged();
    }

    private void edituserevent(AddUserModel? aum)
    {
        //1 by invoking this method inside edit event passing value to parent
        OnUserSelection.InvokeAsync(aum);
        //StateHasChanged();

    }

}