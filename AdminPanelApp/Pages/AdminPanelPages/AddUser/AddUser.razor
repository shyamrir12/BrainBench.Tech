@inject IToastService _toastService
<EditForm Model="@adduser" OnValidSubmit="OnValidSubmit">
    <DataAnnotationsValidator />
    <MudGrid>
        <MudItem xs="12" sm="12">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h5" Align="Align.Start"><b>Add User</b></MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudFocusTrap DefaultFocus="DefaultFocus.FirstChild">
                        <MudSelect T="string" Label="User Role" AnchorOrigin="Origin.BottomCenter" @bind-Value="adduser.roleval">
                            @foreach (var item in adduser.Roletype)
                            {
                                <MudSelectItem Value="@item.Value">@item.Text</MudSelectItem>

                            }
                        </MudSelect>
                        <MudTextField Label="Applicant Name" HelperText="Max. 8 characters"
                        @bind-Value="adduser.name" For="@(() => adduser.name)" />

                        <MudTextField Label="Mobile No" HelperText="Mobile No" Class="mt-3"
                        @bind-Value="adduser.mobile_no" For="@(() => adduser.mobile_no)" />

                        <MudTextField Label="Email Id" Class="mt-3"
                        @bind-Value="adduser.EmailId" For="@(() => adduser.EmailId)" />
                     
                       
                        <MudPaper class="input-group-text" Style="padding:0;border:hidden" Elevation="0">
                            <MudTextField Label="Captcha" HelperText="Sum of given numbers ?" @bind-Value="adduser.captcha" For="@(() => adduser.captcha)" OnlyValidateIfDirty=true />
                            <MudChip Icon="@Icons.Material.Filled.QuestionAnswer" Label="true" Color="Color.Primary">@CaptchaText</MudChip>
                        </MudPaper>

                    </MudFocusTrap>
                </MudCardContent>
                <MudCardActions>



                    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" EndIcon="@Icons.Material.Filled.AppRegistration" Color="Color.Primary"
                               Class="ml-auto" Disabled="@(!context.IsModified() || !context.Validate())" FullWidth="true">Add User</MudButton>


                </MudCardActions>

            </MudCard>
        </MudItem>

        <MudItem xs="12">
            <MudText Typo="Typo.body2" Align="Align.Center">
                Fill out the form correctly to see the success message.
            </MudText>
        </MudItem>
    </MudGrid>
</EditForm>


@code {
    private string CaptchaText;
    private int CaptchaSolution;
    //3.declare parameter for the parent
    [Parameter]
    public AddUserModel adduserparam { get; set; }
    public AddUserModel adduser = new AddUserModel();
    public string buttonText = "Save";



    //3. setting parent parameter to local variable
    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        adduser = adduserparam;
        if (String.IsNullOrEmpty(adduserparam.name))
        {

            buttonText = "Save";
            adduser.designation = "Save";
        }
        else
        {

            buttonText = "Update";
            adduser.designation = "Update";
        }
        adduserparam = null;

    }

    //4 for pass item to parent add event for updated or saved item
    [Parameter]
    public EventCallback<AddUserModel> OnUserUpdation { get; set; }


    private void OnValidSubmit()
    {
        if (!String.IsNullOrEmpty(adduser.name))
        {
            if (buttonText == "Save")
            {

                _toastService.ShowSuccess("Data Save");
            }
            else if (buttonText == "Update")
            {

                _toastService.ShowSuccess("Data Updated");
            }

        }

        //4 by invoking this method sending back updated or added user
        OnUserUpdation.InvokeAsync(adduser);
        // StateHasChanged();




    }
    protected override async Task OnInitializedAsync()
    {
        var captcharesponce = MyUtility.GenerateCaptcha();
        CaptchaSolution = captcharesponce.CaptchaSolution;
        CaptchaText = captcharesponce.CaptchaText;
    }

}
